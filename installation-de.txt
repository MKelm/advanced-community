= papaya CMS Advanced Community Installation =

== Vorwort ==

Diese Installtionsanleitung ist für eine papaya CMS Standardinstallation
geschrieben. Die in dem Modulpacket enthaltenden Templates sind für
das papaya CMS default-Theme erstellt.

== Modulübersicht ==

Das Advanced Community Paket enthält folgende Module:

- Kommentare (Comments Box)
-- Zeigt eine Liste mit Kommentaren und Unterkommentaren an
-- Kommentare können mit gut oder schlecht bewertet werden
-- Enthält ein Eingabeformular für Kommentare oder Unterkommentare
-- Unterstützt Seiten, Surfer und Galleriebilder
--- für Surfer muss ein Seitenparameter mit surfer_handle gesetzt sein
--- für Galleriebilder muss das Surfergallerie-Modul genutzt werden
---- sobald ein Bild ausgewählt wird erscheint die Kommentarbox

- Kommentar-Rangliste (Comments Ranking Box)
-- Zeigt eine Liste mit Kommentaren sortiert nach Bewertung an

- Kommentierer-Rangliste (Commenters Ranking Box)
-- Zeigt eine Liste mit Kommentierern sortiert nach Kommentaranzahl an

- Surferseite (Surfer Page)
-- Optimierte Ausgabe von Surferdetails des aktiven Surfers oder eines gewählten Surfers
-- Unterstützt das Kommentarmodul, siehe oben

- Surferlisten Seite (Surfer List Page)
-- zeigt Kontakte, gestellte Kontaktanfragen und empfangene Kontaktanfragen an
--- enthält Links zum entfernen von Kontakten und/oder aktzeptieren, ablehnen von Anfragen
--- enthält Links zu den Surferseiten
-- oder zeigt Surfer nach Aktivität oder Registrierungszeit an und verlinkt auf die Surferseiten

- Surfergallerie (Surfer Gallery Page)
-- Zeigt eine Thumbnailgallerie für einen gewählten Surfer an
--- für den Surfer muss ein Seitenparameter acg:surfer_handle gesetzt sein
-- Unterstützt das Kommentarmodul, siehe oben

- Mitteilungen (Messages Page)
-- Zeigt eine Liste mit Mitteilungen zwischen Surfer an sofern eine Unterhaltung gewählt wurde
--- zum Navigieren zwischen Unterhaltungen wir eine "Message Conversation Box" benötigt
-- Zeigt einen Dialog zum schreiben von Mitteilungen an

- Unterhaltungen Box (Message Conversations Box)
-- Zeigt eine Liste mit Surfern an zu denen Mitteilungen existieren
-- Zeigt die letzte Mitteilung einer Unterhaltung mit Text und Zeit je Surferkontakt an

- Surferstatus Box (Surfer Status Box)
-- zeigt einen Login / Registrierungslink bei inaktivem Login an
-- zeigt Benutzeravatar und -name bei aktivem Login an
--- enthält zudem einen Surferseiten- und Logoutlink
-- zeigt Anzahl von Kontakten und Kontaktanfragen an
--- enthält passende Links zur Kontakteseite
-- enthält einen Link zur "Messages Page"

- Surferlisten Box (Surfer List Box)
-- zeigt Surfer nach Aktivität oder Registrierungszeit an und verlinkt auf die Surferseiten
-- oder zeigt Kontakte eines gewählten oder des aktiven Surfers an

- Surfergallerie Teaser (Surfer Gallery Teaser Box)
-- Zeigt auf einer Surferseite eine Auswahl von maximal n Thumbnails an
-- Verlinkt auf die Gallerieseite

- Surfergallerie Ordner (Surfer Gallery Folders Box)
-- Zeigt in der Surfergallerie alle Ordner des jeweiligen Surfers an
-- Enthält Links zum Löschen und Hinzufügen von Ordnern wenn der angemeldete
   Surfer dem gewählten Surfer entspricht

- Surfergallerie Upload (Surfer Gallery Upload Box)
-- Zeigt in der Surfergallerie ein Feld zum Hochladen von Bilder an
--- der gewählte Surfer muss mit dem angemeldeten Surfer übereinstimmen

- Conntector
-- Enthält eine onDeleteSurfer Methode für den Action Dispatcher

- Erweiterte Version von "content_thumbs"
-- In dem freien Modul content_thumbs wurden einige Optionen hinzugefügt um eine erweiterte Anzeige
   im Surfergalleriemodul zu ermöglichen
-- die Erweiterung ist solange Bestandteil dieses Pakets bis ein papaya CMS Update erfolgt

== Dateien kopieren ==

Die in dem Paket enthaltenen Dateien sind je papaya CMS Ordner sortiert.
Es reicht die Hauptordner in das papaya CMS Basisverzeichnis zu kopieren.
Wenn papaya-data und papaya-lib in einem externen Verzeichnis liegen,
müssen die entsprechenden Paketordner dorthin kopiert werden.
Das Paket enthält einige Änderungen an bestehenden papaya CMS Dateien:
- papaya-data/templates/default-xhtml/html/boxes.xml
- papaya-data/templates/default-xhtml/html/page_gallery.xsl
- papaya-data/templates/default-xhtml/html/modules/_base/community/content_community.xsl
- papaya-data/templates/default-xhtml/html/modules/free/thumbs/content_thumbs.xsl
- papaya-data/templates/default-xhtml/html/modules/free/thumbs/de-DE.xml
- papaya-data/templates/default-xhtml/html/modules/free/thumbs/en-US.xml
- papaya-data/templates/default-xhtml/html/modules/free/thumbs/fr-FR.xml
- papaya-lib/modules/_base/community/base_surfers.php
- papaya-lib/modules/_base/community/content_userdata.php
- papaya-lib/modules/free/thumbs/content_thumbs.php
- papaya-themes/default/basic.css
- papaya-themes/default/page_thumbs.css
Beim Kopieren werden die alten Versionen dieser Dateien überschrieben.
Im Normalfall sollte die Kompatibilität mit dem aktuellen default-Theme
bestehen bleiben. Sie müssen die Dateien bei jedem papaya CMS Update, das sie durchführen,
aus dem Advanced Community Paket erneut kopieren.

== Module einrichten ==

Um die Advanced Community Module einzurichten gehen sie in das papaya CMS
Backend zum Menüpunkt Module und klicken auf Module suchen. Danach erscheint
in der Liste "Packete" der Punkt "Advanced Community". Wählen sie diesen
Punkt aus und bestätigen sie danach die Frage rechts zum Erstellen von
Pakettabellen mit "Erzeugen".

== Ansichten einrichten ==

Diese Anleitung geht davon aus das eine papaya CMS Standardinstalltion mit
dem Ausgabefilter "html" besteht.
Unter dem Menüpunkt "Ansichten" finden sie das Formular zum Erstellen von
Ansichten.
In der Combobox "Modul" finden sie alle Module unter dem Abschnitt
"Advanced Community".
Nachdem sie eine Ansicht mit Titel erstellt haben müssen sie diese
Ansicht noch mit dem Ausgabefilter "html" verknüpfen.
Dabei ist ein "XSL-Stylesheet" zu wählen. Hier ist eine Liste mit
Modulbezeichnungen und zugehörigen XSL-Stylesheets:

- Commenters Ranking Box = box_acommunity.xsl
- Comments Box = box_acommunity.xsl
- Comments Ranking Box = box_acommunity.xsl
- Surfer Gallery Teaser Box = box_acommunity.xsl
- Surfer Gallery Folders Box = box_acommunity.xsl
- Surfer Gallery Upload Box = box_acommunity.xsl
- Surfer Gallery Page = page_gallery.xsl
- Surfer Page = page_acommunity.xsl
- Message Page = page_acommunity.xsl
- Message Conversations Box = box_acommunity.xsl
- Surfer Status Box = box_acommunity.xsl
- Surfers List Box = box_acommunity.xsl
- Surfers List Oage = page_acommunity.xsl

== Boxen und Seiten einrichten ==

=== Community Module ===

Für eine funktionierende Community benötigen sie zuerst ein paar Seiten des regulären Community
Modulpakets:
- Registrierungs-Seite, zum Registrieren
-- Anleitung http://www.papaya-cms.com/doc/papaya-cms/de/basissystem/5.1.5/ch15s10s08.html
-- Anders als in der Anleitung unterstützt das Modul in papaya CMS 5.5 auch dynamische Datengruppen
-- Im Advanced Community Paket ist eine verbesserte Version enthalten
--- die Anzeige von dynamischen Datengruppen im Eingabeformular wurde optimiert
- Login-Seite, zum Anmelden
-- Anleitung http://www.papaya-cms.com/doc/papaya-cms/de/basissystem/5.1.5/ch15s10.html#N18935
- "Mixed user data"-Seite, zum Bearbeiten von Benutzerdaten mit aktivem Login
-- Anleitung http://www.papaya-cms.com/doc/papaya-cms/de/basissystem/5.1.5/ch15s10s12.html
-- Im Advanced Community Paket ist eine verbesserte Version enthalten
--- die Anzeige von dynamischen Datengruppen im Eingabeformular wurde optimiert

Derzeit fehlen Verlinkungen in Advanced Community Modulen zu diesen Seitentypen.
Für die Zukunft ist eine "Surfer Status Box" geplant, die Links zur Registrierungs- und Login-Seite
enthält, bzw. bei aktivem Login einen Link zur Userdata-Seite.

=== Advanced Community Module ==

- Kommentare (Comments Box)
-- Wählen sie den Menüpunkt "Boxen" um eine Kommentarbox zu erstellen
-- Wählen sie die Boxengruppe "after-content"
-- Erstellen sie eine Box mit der zugehörigen Box-Ansicht und bennen sie diese eindeutig
-- Wählen sie unter "Inhalt" einen Ressourcentyp
--- für normale papaya CMS Seiten ist der Typ "Page"
--- für Seiten mit seiner Surferauswahl (Parameter surfer_handle) ist der Typ "Surfer"
--- für Gallerien mit einer Bildauswahl ist der Typ "Image"
-- Ändern sie bei Bedarf weitere Einstellungen
-- Sie müssen maximal drei Boxen erstellen um alle Ressourcentypen zu unterstützen
-- Publizieren sie die erstellte/n Box/en
-- Hängen sie die Box in einer Seite unter dem Punkt "Boxen" ein
--- für Bildkommentare brauchen sie zuerst eine Surfergallerie-Seite, siehe unten
--- Surferkommentare funktionieren z.B. mit dem Communityseitenmodul "Show user"
---- ein erweitertes Surfer Page Modul für die Advanced Community ist in Planung

- Kommentar-Rangliste (Comments Ranking Box)
-- Wählen sie den Menüpunkt "Boxen" um eine Ranglistenbox zu erstellen
-- Wählen sie die Boxengruppe "after-content"
-- Erstellen sie eine Box mit der zugehörigen Box-Ansicht und bennen sie diese eindeutig
-- Wählen sie der Punkt "Inhalt" und ändern sie bei Bedarf die Einstellungen
-- Publizieren sie die Box
-- Hängen sie die Box in einer Seite unter dem Punkt "Boxen" ein

- Kommentierer-Rangliste (Commenters Ranking Box)
-- Wählen sie den Menüpunkt "Boxen" um eine Ranglistenbox zu erstellen
-- Wählen sie die Boxengruppe "additional"
-- Erstellen sie eine Box mit der zugehörigen Box-Ansicht und bennen sie diese eindeutig
-- Wählen sie der Punkt "Inhalt" und ändern sie bei Bedarf die Einstellungen
-- Publizieren sie die Box
-- Hängen sie die Box in einer Seite unter dem Punkt "Boxen" ein

- Surferseite (Surfer Page)
-- Wählen sie den Menüpunkt "Ändern" um eine Surferseite zu erstellen
-- Wählen sie die Hauptseite ihrer Standardinstallation um eine Unterseite zu erstellen
-- Danach bennen sie die neue Unterseite eindeutig
-- Weisen sie der Seite die zugehörige Seitenansicht unter "Ansicht" zu
-- Gehen sie zu "Inhalt" und ändern sie bei Bedarf die Einstellungen
-- Publizieren sie die Seite

- Surferlistenseite (Surfer List Page)
-- Wählen sie den Menüpunkt "Ändern" um eine Seite zu erstellen
-- Wählen sie die Hauptseite ihrer Standardinstallation um eine Unterseite zu erstellen
-- Danach bennen sie die neue Unterseite eindeutig
-- Weisen sie der Seite die zugehörige Seitenansicht unter "Ansicht" zu
-- Gehen sie zu "Inhalt" und ändern sie bei Bedarf die Einstellungen
--- sie brauchen maximal drei Seiten um alle Ausgabemodi in ihrem Angebot zu verlinken
-- Publizieren sie die Seite

- Mitteilungen (Messages Page)
-- Wählen sie den Menüpunkt "Ändern" um eine Surferseite zu erstellen
-- Wählen sie die Hauptseite ihrer Standardinstallation um eine Unterseite zu erstellen
-- Danach bennen sie die neue Unterseite eindeutig
-- Weisen sie der Seite die zugehörige Seitenansicht unter "Ansicht" zu
-- Gehen sie zu "Inhalt" und ändern sie bei Bedarf die Einstellungen
-- Publizieren sie die Seite

- Unterhaltungen Box (Message Conversations Box)
-- Wählen sie den Menüpunkt "Boxen" um eine Ordnerbox zu erstellen
-- Wählen sie die Boxengruppe "additional"
-- Erstellen sie eine Box mit der zugehörigen Box-Ansicht und bennen sie diese eindeutig
-- Wählen sie der Punkt "Inhalt" und ändern sie bei Bedarf die Einstellungen
-- Publizieren sie die Box
-- Hängen sie die Box auf ihren Seiten unter dem Punkt "Boxen" ein

- Surfergallerie (Surfer Gallery Page)
-- Wählen sie den Menüpunkt "Dateien"
-- Erstellen sie einen neuen (Unter-)Ordner für Surfergallerien
-- Wählen sie den Menüpunkt "Ändern" um eine Surfergallerie-Seite zu erstellen
-- Wählen sie die Hauptseite ihrer Standardinstallation um eine Unterseite zu erstellen
-- Danach bennen sie die neue Unterseite eindeutig
-- Weisen sie der Seite die zugehörige Seitenansicht unter "Ansicht" zu
-- Gehen sie zu "Inhalt" und wählen sie unter "Ordner" den zuvor erstellen Dateiordner
-- Ändern sie auch folgende Optionen um eine optimale Anzeige der Surfergallerie zu ermöglichen
--- Vorschaubilder, Anzahl Vorschaubilder auf 4
--- Vorschaubilder, Spaltenanzahl auf 2
--- Vorschaubilder, Größe verändern auf "Minimum cropped"
--- Vorschaubilder, Breite und Höhe auf 200
--- Bilder, Display in Lightbox? auf "Nein"
---- Die Lightbox kann aktiviert werden, wenn keine Kommentarbox in der Surfergallerie genutzt wird
--- Bilder, Anzeigemodues auf "Resized Image" oder "Resized image with download link" oder
    "Resized image with original image link"
--- Bilder, Breite und Höhe auf 410
-- Ändern sie bei Bedarf weitere Einstellungen
-- Publizieren sie die Seite

- Surferstatus Box (Surfer Status Box)
-- Wählen sie den Menüpunkt "Boxen" um eine Ordnerbox zu erstellen
-- Wählen sie die Boxengruppe "additional"
-- Erstellen sie eine Box mit der zugehörigen Box-Ansicht und bennen sie diese eindeutig
-- Wählen sie der Punkt "Inhalt" und ändern sie bei Bedarf die Einstellungen
-- Publizieren sie die Box
-- Hängen sie die Box auf ihren Seiten unter dem Punkt "Boxen" ein

- Surferstatus Box (Surfers List Box)
-- Wählen sie den Menüpunkt "Boxen" um eine Ordnerbox zu erstellen
-- Wählen sie die Boxengruppe "after-content" oder "additional-content"
-- Erstellen sie eine Box mit der zugehörigen Box-Ansicht und bennenen sie diese eindeutig
-- Wählen sie der Punkt "Inhalt"
--- Wählen sie den "Anzeigemodus"
---- sie benötigen zwei dieser Boxen um die Ausgabemodi "Surfers by last action time" und
     "Surfers by registration time" auf z.B. einer Seite einzuhängen
---- sie benötigen eine weitere Box um den Ausgabemodus "Surfer contacts of current or selected surfer"
     auf z.B. der Surferseite einzuhängen
--- ändern sie bei Bedarf weiter Einstellungen
-- Publizieren sie die Box
-- Hängen sie die Box auf ihren Seiten unter dem Punkt "Boxen" ein

- Surfergallerie Teaser (Surfer Gallery Teaser Box)
-- Wählen sie den Menüpunkt "Boxen" um eine Ordnerbox zu erstellen
-- Wählen sie die Boxengruppe "after-content"
-- Erstellen sie eine Box mit der zugehörigen Box-Ansicht und bennen sie diese eindeutig
-- Wählen sie der Punkt "Inhalt" und ändern sie bei Bedarf die Einstellungen
-- Publizieren sie die Box
-- Hängen sie die Box auf ihrer Surferseite unter dem Punkt "Boxen" ein

- Surfergallerie Ordner (Surfer Gallery Folders Box)
-- Wählen sie den Menüpunkt "Boxen" um eine Ordnerbox zu erstellen
-- Wählen sie die Boxengruppe "before-content"
-- Erstellen sie eine Box mit der zugehörigen Box-Ansicht und bennen sie diese eindeutig
-- Wählen sie der Punkt "Inhalt" und ändern sie bei Bedarf die Einstellungen
-- Publizieren sie die Box
-- Hängen sie die Box auf ihrer Surfergallerieseite unter dem Punkt "Boxen" ein

- Surfergallerie Upload (Surfer Gallery Upload Box)
-- Wählen sie den Menüpunkt "Boxen" um eine Ranglistenbox zu erstellen
-- Wählen sie die Boxengruppe "after-content"
-- Erstellen sie eine Box mit der zugehörigen Box-Ansicht und bennen sie diese eindeutig
-- Wählen sie der Punkt "Inhalt" und ändern sie bei Bedarf die Einstellungen
-- Publizieren sie die Box
-- Hängen sie die Box auf ihrer Surfergallerieseite unter dem Punkt "Boxen" ein

== Action Dispatcher einrichten ==

Der Action Dispatcher sollte eingerichtet werden um Daten gelöschter Surfer und Seiten
in der Advanced Community korrekt zu handhaben.

Bitte lesen sie auch die Action Dispatcher Anleitung auf
http://de.wiki.papaya-cms.com/wiki/Action_Dispatcher

=== Surferdaten löschen ===

Sie brauchen im Action Dispatcher eine Gruppe "community" und eine Aktion "onDeleteSurfer"
danach können sie die Observerklasse "ACommunityConnector" der Aktion
hinzufügen.

Der Advanced Community Connector führt über den Action Dispatcher beim
Löschen eines Surfers folgende Aktionen aus:
- Seitenkommentare werden mit einem Flag versehen, dass der Surfer gelöscht wurde
-- in den Kommentarlisten werden später Surferhandles mit "Deleted user" ö.ä. ersetzt
-- im Kommentiererranking werden gelöschte Surfer ignoriert
- Surferkommentare zum gelöschten Surfer werden komplett gelöscht
- Surfergallerien werden mitsamt aller Ordner, Bilder und Bildkommentaren gelöscht

=== Seitendaten löschen ===

Zuerst müssen sie die Datei papaya-lib/system/base_topic_edit.php bearbeiten. Nehmen sie den Inhalt
der Datei base_topic_edit_destroy_replacement.php und ersetzen sie die Methode destroy() komplett.
Der Replacement-Code enthält einen gültigen Action Dispatcher-Aufruf um Seitendaten zu löschen.
Diese Aktion müssen sie bei jedem papaya CMS Update das sie durchführen wiederholen.

Sie brauchen danach im Action Dispatcher noch eine Gruppe "system" und eine Aktion "onDeletePages".
Dann können sie die Observerklasse "ACommunityConnector" der Aktion hinzufügen.

Der Advanced Community Connector führt über den Action Dispatcher beim
Löschen einer Seite folgende Aktionen aus:
- Seitenkommentare zur gelöschten Seite werden komplett gelöscht

== Verlinkungen von Surferseiten ==

Um Surfer in Boxen und Seiten korrekt zu verlinken, müssen sie die Moduloptionen des Connectors anpassen.
Diese Moduloptionen werden von vielen Advanced Community Modulen genutzt um Links zu erzeugen.
Bevor sie die Optionen ändern, benötigen sie entsprechende Seiten in ihrem Seitenbaum.

Moduloptionen ändern, z.B. für "Surfer Page" und "Surfer Gallery Page":
- Öffnen sie die Modulübersicht im Menüpunkt "Module"
- Öffnen sie das Paket "Advanced Community"
- Wählen sie das Modul "Connector" aus
- Wählen sie rechts den Punkt "Optionen" aus
- Setzen sie die Option "Page IDs" -> "Surfer Page" und "Page IDs" -> "Surfer Gallery Page" korrekt
- Danach können sie von Kommentarboxen aus die Surferdetailseite erreichen
-- Beispiel-URL: infis-page.70.de.html?acs:surfer_handle=infi
- Danach können sie von Gallerieteaserboxen aus die Surfergallerie erreichen
-- Beispiel-URL: infis-gallery.71.de.html?acg:surfer_handle=infi

Sie können auch die Parametergruppe der Surferseiten einstellen. Sie brauchen jedoch nur eine andere
Parametergruppe, wenn sie ein anderes Seitenmodul als "Surfer Page" nutzen. Dieser Ansatz ist
z.B. mit dem "Show user"-Modul der Community kompatibel, dessen Parametergruppe "bab" lautet.

Es gibt noch weitere Page ID-Einstellungen in den Moduloptionen des Connectors:
- Login Page = Seiten ID der Anmeldeseite, wird in "Surfer Status Box" genutzt
- Registration Page = Seiten ID der Registrierungsseite, wird in "Surfer Status Box" genutzt
- Editor Page = Seiten ID des "Mixed user data"-Moduls, wird in "Surfer Status Box" genutzt
- Contacts Page = Seiten ID eines "Surfer List Page"-Moduls mit einer Ausgabe von Kontakten
-- wird in "Surfer Status Box" genutzt
- Messages Page = Seiten ID eines "Message Page"-Modules mit Ausgabe von Mitteilungen
-- wird in "Surfer Status Box" genutzt